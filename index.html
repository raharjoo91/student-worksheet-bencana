<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Lembar Kerja Siswa - Perencanaan Situs Rumah Sakit Lapangan Darurat">
  <title>Lembar Kerja Siswa - Rumah Sakit Lapangan Darurat</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --primary-light: #3b82f6;
      --secondary: #10b981;
      --accent: #f59e0b;
      --text: #1f2937;
      --text-light: #6b7280;
      --bg-primary: #ffffff;
      --bg-secondary: #f9fafb;
      --bg-tertiary: #f3f4f6;
      --border: #e5e7eb;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --spacing-sm: 1rem;
      --spacing-md: 1.5rem;
      --spacing-lg: 2rem;
      --spacing-xl: 3rem;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      line-height: 1.7;
      color: var(--text);
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: var(--spacing-md);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: var(--bg-primary);
      padding: var(--spacing-xl);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
    }

    header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-lg);
      border-bottom: 3px solid var(--primary);
    }

    h1 {
      color: var(--primary);
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: var(--spacing-sm);
    }

    .subtitle {
      color: var(--text-light);
      font-size: 1rem;
    }

    h2 {
      color: var(--primary);
      font-size: 1.5rem;
      font-weight: 600;
      margin-top: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
      padding-bottom: var(--spacing-sm);
      border-bottom: 2px solid var(--border);
    }

    h3 {
      color: var(--primary-dark);
      font-size: 1.125rem;
      font-weight: 600;
      margin-top: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
    }

    .section {
      margin-bottom: var(--spacing-lg);
    }

    .info-box {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      padding: var(--spacing-md);
      border-left: 4px solid var(--primary);
      border-radius: var(--radius-md);
      margin: var(--spacing-md) 0;
    }

    .warning-box {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      padding: var(--spacing-md);
      border-left: 4px solid var(--warning);
      border-radius: var(--radius-md);
      margin: var(--spacing-md) 0;
    }

    .scenario-card {
      background: var(--bg-secondary);
      padding: var(--spacing-md);
      border-radius: var(--radius-lg);
      margin: var(--spacing-md) 0;
      border-left: 5px solid;
      box-shadow: var(--shadow-md);
      transition: transform 0.2s ease;
      cursor: pointer;
    }

    .scenario-card:hover {
      transform: translateX(4px);
    }

    .scenario-card.selected {
      box-shadow: 0 0 0 3px var(--primary);
    }

    .scenario-a { border-left-color: #3b82f6; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); }
    .scenario-b { border-left-color: #10b981; background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); }
    .scenario-c { border-left-color: #f59e0b; background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); }

    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      margin-left: var(--spacing-sm);
    }

    .badge-type-1 { background: #3b82f6; color: white; }
    .badge-type-2 { background: #10b981; color: white; }
    .badge-type-3 { background: #f59e0b; color: white; }

    .checklist {
      list-style: none;
      padding: 0;
    }

    .checklist li {
      padding: var(--spacing-sm);
      margin: var(--spacing-xs) 0;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      display: flex;
      align-items: flex-start;
      gap: var(--spacing-sm);
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .checklist li:hover {
      background: #e5e7eb;
    }

    .checklist li.checked {
      background: #d1fae5;
    }

    .checklist li::before {
      content: '‚òê';
      font-size: 1.25rem;
      color: var(--primary);
      flex-shrink: 0;
    }

    .checklist li.checked::before {
      content: '‚òë';
      color: var(--success);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: var(--spacing-md) 0;
      font-size: 0.9rem;
    }

    th, td {
      padding: var(--spacing-sm);
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    th {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
    }

    .zone-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-md) 0;
    }

    .zone-card {
      background: white;
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      border-left: 4px solid var(--primary);
      box-shadow: var(--shadow-sm);
    }

    .zone-card .code {
      font-weight: 700;
      color: var(--primary);
      font-size: 1.25rem;
    }

    .zone-card .name {
      font-weight: 600;
      margin-top: var(--spacing-xs);
      font-size: 0.9rem;
    }

    .reference-layouts {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-md) 0;
    }

    .layout-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-md);
      transition: transform 0.2s ease;
    }

    .layout-card:hover {
      transform: scale(1.02);
    }

    .layout-card img {
      width: 100%;
      height: auto;
      display: block;
    }

    .layout-card .caption {
      padding: var(--spacing-sm);
      font-size: 0.875rem;
      color: var(--text);
      text-align: center;
      font-weight: 600;
    }

    .input-section {
      background: var(--bg-secondary);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin: var(--spacing-sm) 0;
    }

    .input-section label {
      display: block;
      font-weight: 600;
      margin-bottom: var(--spacing-xs);
    }

    .input-section input, .input-section textarea, .input-section select {
      width: 100%;
      padding: var(--spacing-sm);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-family: inherit;
    }

    .timer {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--primary);
      color: white;
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-lg);
      font-weight: 700;
      font-size: 1.25rem;
      box-shadow: var(--shadow-lg);
      z-index: 100;
    }

    /* Drawing Canvas Styles */
    .drawing-section {
      background: var(--bg-secondary);
      padding: var(--spacing-md);
      border-radius: var(--radius-lg);
      margin: var(--spacing-lg) 0;
    }

    .canvas-container {
      position: relative;
      background: white;
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      margin: var(--spacing-md) 0;
      overflow: hidden;
    }

    #drawingCanvas {
      display: block;
      cursor: crosshair;
      background: white;
    }

    .canvas-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm);
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-sm);
    }

    .tool-btn {
      padding: var(--spacing-xs) var(--spacing-sm);
      border: 1px solid var(--border);
      background: white;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }

    .tool-btn:hover {
      background: var(--primary);
      color: white;
    }

    .tool-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .color-picker {
      width: 40px;
      height: 35px;
      border: 2px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
    }

    .zone-stamps {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
      margin-top: var(--spacing-sm);
    }

    .zone-stamp {
      padding: 0.25rem 0.5rem;
      background: var(--primary-light);
      color: white;
      border-radius: var(--radius-md);
      font-size: 0.75rem;
      cursor: pointer;
      border: none;
    }

    .zone-stamp:hover {
      background: var(--primary);
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
      margin: var(--spacing-lg) 0;
      justify-content: center;
    }

    .btn {
      padding: var(--spacing-sm) var(--spacing-md);
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #059669;
      transform: translateY(-2px);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    @media (max-width: 768px) {
      body { padding: var(--spacing-sm); }
      .container { padding: var(--spacing-md); }
      h1 { font-size: 1.5rem; }
      .timer { font-size: 1rem; padding: var(--spacing-xs) var(--spacing-sm); }
      #drawingCanvas { width: 100%; }
    }

    @media print {
      body { background: white; padding: 0; }
      .container { box-shadow: none; }
      .timer, .canvas-toolbar, .action-buttons { display: none; }
    }
  </style>
</head>
<body>
  <div class="timer" id="timer">00:00</div>

  <div class="container" id="mainContent">
    <header>
      <h1>Lembar Kerja Siswa</h1>
      <p class="subtitle">Perencanaan Situs Rumah Sakit Lapangan Darurat</p>
    </header>

    <!-- INFO TIM -->
    <div class="section">
      <h2>Informasi Tim</h2>
      <div class="input-section">
        <label>Nama Tim:</label>
        <input type="text" id="teamName" placeholder="Masukkan nama tim">
      </div>
      <div class="input-section">
        <label>Anggota Tim:</label>
        <textarea id="teamMembers" rows="3" placeholder="Daftar semua anggota tim"></textarea>
      </div>
      <div class="input-section">
        <label>Skenario yang Dipilih:</label>
        <select id="scenarioSelect">
          <option value="">-- Pilih skenario Anda --</option>
          <option value="A">Skenario A: Gempa Bumi Remote (Tipe 1)</option>
          <option value="B">Skenario B: Banjir Urban + Kolera (Tipe 2)</option>
          <option value="C">Skenario C: Erupsi Vulkanik & Pengungsian Massal (Tipe 3)</option>
        </select>
      </div>
    </div>

    <!-- TUJUAN PEMBELAJARAN -->
    <div class="section">
      <h2>Tujuan Pembelajaran</h2>
      <div class="info-box">
        <p>Pada akhir latihan ini, Anda akan mampu:</p>
        <ol style="margin-left: var(--spacing-lg); margin-top: var(--spacing-sm);">
          <li>Mendesain tata letak situs 2D yang sesuai standar untuk rumah sakit lapangan darurat</li>
          <li>Menerapkan standar teknis minimum untuk zona fungsional, WASH, dan buffer keamanan</li>
          <li>Mengintegrasikan layanan esensial: komando, kesehatan reproduksi, dan dukungan kesehatan mental</li>
        </ol>
      </div>
    </div>

    <!-- SKENARIO -->
    <div class="section">
      <h2>Pilih Skenario Anda</h2>
      <p style="margin-bottom: var(--spacing-sm);"><em>Klik pada skenario untuk memilih</em></p>

      <div class="scenario-card scenario-a" onclick="selectScenario('A', this)">
        <h3>Skenario A: Gempa Bumi Remote <span class="badge badge-type-1">Tipe 1</span></h3>
        <p><strong>Konteks:</strong> Gempa 7.0 SR di wilayah pegunungan. Jalan rusak. Tidak ada listrik atau bangunan.</p>
        <p><strong>Fokus:</strong> Perawatan rawat jalan, manajemen luka, pemeriksaan maternal, pengisian obat penyakit kronis.</p>
        <p><strong>Situs:</strong> Lapangan datar (80m √ó 60m). Sepenuhnya menggunakan tenda.</p>
        <p><strong>Kapasitas:</strong> 20‚Äì50 tempat tidur</p>
      </div>

      <div class="scenario-card scenario-b" onclick="selectScenario('B', this)">
        <h3>Skenario B: Banjir Urban + Wabah Kolera <span class="badge badge-type-2">Tipe 2</span></h3>
        <p><strong>Konteks:</strong> Banjir muson mengungsikan 20.000 jiwa di kawasan urban berpendapatan rendah. Genangan air, sanitasi buruk.</p>
        <p><strong>Fokus:</strong> Perawatan rawat inap rehidrasi, kontrol infeksi, bedah darurat, diagnostik lab, kesehatan reproduksi & mental.</p>
        <p><strong>Situs:</strong> Tanah sekolah yang lebih tinggi (120m √ó 100m). Sebagian permukaan keras tersedia.</p>
        <p><strong>Kapasitas:</strong> 50‚Äì100 tempat tidur</p>
      </div>

      <div class="scenario-card scenario-c" onclick="selectScenario('C', this)">
        <h3>Skenario C: Erupsi Vulkanik & Pengungsian Massal <span class="badge badge-type-3">Tipe 3</span></h3>
        <p><strong>Konteks:</strong> Erupsi besar memaksa 50.000+ jiwa mengungsi. Abu vulkanik mengganggu air, listrik, dan layanan kesehatan.</p>
        <p><strong>Fokus:</strong> Suite bedah lengkap, ICU, perawatan respirasi, kesehatan mental, telemedisin, pelatihan, kesehatan reproduksi.</p>
        <p><strong>Situs:</strong> Area evakuasi besar (150m √ó 120m). Konstruksi hibrida dengan bangunan permanen bila tersedia.</p>
        <p><strong>Kapasitas:</strong> 100‚Äì200+ tempat tidur</p>
      </div>
    </div>

    <!-- ZONA YANG DIBUTUHKAN -->
    <div class="section">
      <h2>Zona Fungsional yang Diperlukan</h2>
      <p>Gunakan panduan ini saat merencanakan tata letak Anda. Semua zona harus disertakan.</p>

      <div class="zone-grid">
        <div class="zone-card">
          <div class="code">1</div>
          <div class="name">Komando & Admin</div>
        </div>
        <div class="zone-card">
          <div class="code">2</div>
          <div class="name">Rawat Inap Pria</div>
        </div>
        <div class="zone-card">
          <div class="code">3</div>
          <div class="name">Rawat Inap Wanita</div>
        </div>
        <div class="zone-card">
          <div class="code">4</div>
          <div class="name">Rawat Jalan (OPD)</div>
          <div style="font-size: 0.75rem; color: var(--text-light);">+ Kesehatan Reproduksi</div>
        </div>
        <div class="zone-card">
          <div class="code">5</div>
          <div class="name">ICU</div>
        </div>
        <div class="zone-card">
          <div class="code">6</div>
          <div class="name">IGD (UGD)</div>
        </div>
        <div class="zone-card">
          <div class="code">7</div>
          <div class="name">Akomodasi Staf</div>
        </div>
        <div class="zone-card">
          <div class="code">8</div>
          <div class="name">Ruang Operasi</div>
        </div>
        <div class="zone-card">
          <div class="code">9</div>
          <div class="name">CSSD</div>
          <div style="font-size: 0.75rem; color: var(--text-light);">Sterilisasi</div>
        </div>
        <div class="zone-card">
          <div class="code">10</div>
          <div class="name">Farmasi</div>
        </div>
        <div class="zone-card">
          <div class="code">11</div>
          <div class="name">Toilet Staf</div>
        </div>
        <div class="zone-card">
          <div class="code">12</div>
          <div class="name">X-Ray</div>
        </div>
        <div class="zone-card">
          <div class="code">13</div>
          <div class="name">Toilet Pasien/WC</div>
        </div>
        <div class="zone-card">
          <div class="code">14</div>
          <div class="name">Purifikasi Air</div>
        </div>
        <div class="zone-card">
          <div class="code">15</div>
          <div class="name">Tangki Air Utama</div>
        </div>
        <div class="zone-card">
          <div class="code">16</div>
          <div class="name">Dapur</div>
        </div>
        <div class="zone-card">
          <div class="code">17</div>
          <div class="name">Gudang Logistik</div>
        </div>
        <div class="zone-card">
          <div class="code">18</div>
          <div class="name">Genset</div>
        </div>
        <div class="zone-card">
          <div class="code">19</div>
          <div class="name">Keamanan/Bendera</div>
        </div>
        <div class="zone-card">
          <div class="code">‚Äî</div>
          <div class="name">Unit MHPSS</div>
          <div style="font-size: 0.75rem; color: var(--text-light);">Kesehatan Mental (Tipe 2/3)</div>
        </div>
      </div>
    </div>

    <!-- DAFTAR PERIKSA DESAIN -->
    <div class="section">
      <h2>Daftar Periksa Perencanaan Situs</h2>
      <ul class="checklist">
        <li onclick="toggleCheck(this)">Batas situs dengan dimensi ditandai</li>
        <li onclick="toggleCheck(this)">Enam zona fungsional teridentifikasi (Klinis, Dukungan, Logistik, Administrasi, Staf, Keamanan)</li>
        <li onclick="toggleCheck(this)">Titik masuk pasien di bagian depan</li>
        <li onclick="toggleCheck(this)">Area ambulance dapat diakses</li>
        <li onclick="toggleCheck(this)">Tenda klinis dengan kapasitas tempat tidur ditandai</li>
        <li onclick="toggleCheck(this)">Tangki air (15) + purifikasi (14) diposisikan bersama</li>
        <li onclick="toggleCheck(this)">Fasilitas sanitasi (13, 11) ‚â•30m dari sumber air</li>
        <li onclick="toggleCheck(this)">Area limbah medis ‚â•500m dari populasi</li>
        <li onclick="toggleCheck(this)">Koridor utilitas untuk pergerakan</li>
        <li onclick="toggleCheck(this)">Akomodasi staf dengan WASH terpisah</li>
        <li onclick="toggleCheck(this)">Pintu keluar darurat ditandai</li>
        <li onclick="toggleCheck(this)">Area parkir/loading dapat diakses</li>
        <li onclick="toggleCheck(this)">Perimeter keamanan dengan bendera (19)</li>
        <li onclick="toggleCheck(this)">Unit MHPSS disertakan (Tipe 2/3 saja)</li>
        <li onclick="toggleCheck(this)">Kesehatan reproduksi terintegrasi (Tipe 2/3 saja)</li>
      </ul>
    </div>

    <!-- ATURAN KEAMANAN KRITIS -->
    <div class="section">
      <h2>Aturan Keamanan Kritis</h2>
      <div class="warning-box">
        <h3>Persyaratan WASH</h3>
        <ul>
          <li>Sanitasi (toilet) harus ‚â•30 meter dari sumber air</li>
          <li>Fasilitas WASH staf dan pasien harus terpisah</li>
          <li>Area limbah medis harus ‚â•500 meter dari pusat populasi</li>
        </ul>
      </div>
      <div class="warning-box">
        <h3>Prinsip Zonasi</h3>
        <ul>
          <li>Zona klinis harus terpisah dari logistik/dukungan</li>
          <li>IGD harus dekat dengan pintu masuk</li>
          <li>Area isolasi untuk kasus infeksi (bila berlaku)</li>
          <li>Genset menjauh dari area pasien karena suara/gas</li>
        </ul>
      </div>
    </div>

    <!-- REFERENSI TATA LETAK -->
    <div class="section">
      <h2>Referensi Tata Letak</h2>
      <p>Contoh tata letak rumah sakit lapangan untuk referensi perencanaan Anda:</p>

      <div class="reference-layouts">
        <div class="layout-card">
          <img src="REFERENCE%20LAYOUT/Layout%201.png" alt="Layout Referensi 1">
          <div class="caption">Layout Referensi 1</div>
        </div>
        <div class="layout-card">
          <img src="REFERENCE%20LAYOUT/Layout%202.png" alt="Layout Referensi 2">
          <div class="caption">Layout Referensi 2</div>
        </div>
        <div class="layout-card">
          <img src="REFERENCE%20LAYOUT/Layout%203.png" alt="Layout Referensi 3">
          <div class="caption">Layout Referensi 3</div>
        </div>
        <div class="layout-card">
          <img src="REFERENCE%20LAYOUT/Layout%204.png" alt="Layout Referensi 4">
          <div class="caption">Layout Referensi 4</div>
        </div>
        <div class="layout-card">
          <img src="REFERENCE%20LAYOUT/Layout%205.png" alt="Layout Referensi 5">
          <div class="caption">Layout Referensi 5</div>
        </div>
        <div class="layout-card">
          <img src="REFERENCE%20LAYOUT/Layout%206.png" alt="Layout Referensi 6">
          <div class="caption">Layout Referensi 6</div>
        </div>
      </div>
    </div>

    <!-- AREA MENGGAMBAR -->
    <div class="section">
      <h2>Area Desain Situs - Gambar Tata Letak Anda</h2>
      <p>Gunakan kanvas di bawah ini untuk menggambar tata letak situs 2D Anda.</p>

      <div class="drawing-section">
        <div class="canvas-toolbar">
          <button class="tool-btn active" onclick="setTool('pen')" title="Pena">‚úèÔ∏è Pena</button>
          <button class="tool-btn" onclick="setTool('eraser')" title="Penghapus">üßπ Penghapus</button>
          <button class="tool-btn" onclick="setTool('text')" title="Teks">üìù Teks</button>
          <button class="tool-btn" onclick="setTool('rect')" title="Kotak">‚¨ú Kotak</button>
          <button class="tool-btn" onclick="setTool('circle')" title="Lingkaran">‚≠ï Lingkaran</button>

          <input type="color" class="color-picker" id="colorPicker" value="#2563eb" title="Pilih Warna">

          <select id="brushSize" class="tool-btn" onchange="setBrushSize(this.value)">
            <option value="2">Tipis</option>
            <option value="4" selected>Normal</option>
            <option value="8">Tebal</option>
            <option value="12">Sangat Tebal</option>
          </select>

          <button class="tool-btn" onclick="undoCanvas()" title="Undo">‚Ü∂ Undo</button>
          <button class="tool-btn" onclick="clearCanvas()" title="Hapus Semua">üóëÔ∏è Hapus</button>
        </div>

        <div class="zone-stamps">
          <button class="zone-stamp" onclick="addStamp(1)">1. Komando</button>
          <button class="zone-stamp" onclick="addStamp(2)">2. Rawat Inap Pria</button>
          <button class="zone-stamp" onclick="addStamp(3)">3. Rawat Inap Wanita</button>
          <button class="zone-stamp" onclick="addStamp(4)">4. OPD</button>
          <button class="zone-stamp" onclick="addStamp(5)">5. ICU</button>
          <button class="zone-stamp" onclick="addStamp(6)">6. IGD</button>
          <button class="zone-stamp" onclick="addStamp(7)">7. Staf</button>
          <button class="zone-stamp" onclick="addStamp(8)">8. OK</button>
          <button class="zone-stamp" onclick="addStamp(9)">9. CSSD</button>
          <button class="zone-stamp" onclick="addStamp(10)">10. Farmasi</button>
          <button class="zone-stamp" onclick="addStamp(11)">11. Toilet Staf</button>
          <button class="zone-stamp" onclick="addStamp(12)">12. X-Ray</button>
          <button class="zone-stamp" onclick="addStamp(13)">13. Toilet Pasien</button>
          <button class="zone-stamp" onclick="addStamp(14)">14. Purifikasi</button>
          <button class="zone-stamp" onclick="addStamp(15)">15. Tangki Air</button>
          <button class="zone-stamp" onclick="addStamp(16)">16. Dapur</button>
          <button class="zone-stamp" onclick="addStamp(17)">17. Gudang</button>
          <button class="zone-stamp" onclick="addStamp(18)">18. Genset</button>
          <button class="zone-stamp" onclick="addStamp(19)">19. Keamanan</button>
          <button class="zone-stamp" onclick="addStamp(20)">MHPSS</button>
        </div>

        <div class="canvas-container">
          <canvas id="drawingCanvas" width="1100" height="600"></canvas>
        </div>
      </div>
    </div>

    <!-- EVALUASI DIRI -->
    <div class="section">
      <h2>Evaluasi Diri</h2>
      <p>Sebelum menyerahkan desain Anda, tinjau terhadap pertanyaan-pertanyaan ini:</p>
      <ul class="checklist">
        <li onclick="toggleCheck(this)">Apakah Komando/Admin (Zona 1) diposisikan secara sentral untuk koordinasi?</li>
        <li onclick="toggleCheck(this)">Apakah fasilitas WASH pasien dan staf terpisah dan ‚â•30m dari air?</li>
        <li onclick="toggleCheck(this)">Apakah kesehatan reproduksi terintegrasi dalam skenario Tipe 2/3?</li>
        <li onclick="toggleCheck(this)">Apakah MHPSS disertakan untuk skenario Tipe 2/3?</li>
        <li onclick="toggleCheck(this)">Apakah limbah medis dan genset ditempatkan dengan aman menjauh dari area berpenduduk?</li>
        <li onclick="toggleCheck(this)">Apakah alur pasien logis dari masuk ke triase ke pengobatan?</li>
        <li onclick="toggleCheck(this)">Apakah pintu keluar darurat ditandai dengan jelas?</li>
        <li onclick="toggleCheck(this)">Apakah area ambulance dapat diakses tanpa melintasi area pasien?</li>
      </ul>
    </div>

    <!-- CATATAN TIM -->
    <div class="section">
      <h2>Catatan Tim</h2>
      <div class="input-section">
        <label>Catatan tambahan, tantangan, atau keputusan yang dibuat:</label>
        <textarea id="teamNotes" rows="5" placeholder="Dokumentasikan keputusan desain dan rasional tim Anda..."></textarea>
      </div>
    </div>

    <!-- TOMBOL AKSI -->
    <div class="action-buttons">
      <button class="btn btn-primary" onclick="saveToLocalStorage()">
        üíæ Simpan Secara Lokal
      </button>
      <button class="btn btn-success" onclick="exportAsPDF()">
        üìÑ Ekspor sebagai PDF
      </button>
      <button class="btn btn-primary" onclick="downloadAsImage()">
        üñºÔ∏è Download Gambar Desain
      </button>
      <button class="btn btn-primary" onclick="sendToGoogleDrive()">
        üì§ Kirim ke Google Drive
      </button>
      <button class="btn btn-danger" onclick="clearAllData()">
        üóëÔ∏è Hapus Semua Data
      </button>
    </div>

    <div style="text-align: center; margin-top: var(--spacing-xl); padding-top: var(--spacing-lg); border-top: 2px solid var(--border); color: var(--text-light); font-size: 0.875rem;">
      <p>Perencanaan Situs Rumah Sakit Lapangan Darurat - Lembar Kerja Siswa</p>
      <p><strong>Manajemen Bencana - 2025/2026 Genap</strong></p>
      <p>UNTUK KEGIATAN PELATIHAN SAJA</p>
    </div>
  </div>

  <script>
    // Timer functionality
    let seconds = 0;
    let timerInterval;

    function formatTime(sec) {
      const mins = Math.floor(sec / 60);
      const secs = sec % 60;
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function updateTimer() {
      seconds++;
      document.getElementById('timer').textContent = formatTime(seconds);
    }

    timerInterval = setInterval(updateTimer, 1000);

    // Scenario selection
    let selectedScenario = '';

    function selectScenario(scenario, element) {
      selectedScenario = scenario;
      document.querySelectorAll('.scenario-card').forEach(card => card.classList.remove('selected'));
      element.classList.add('selected');
      document.getElementById('scenarioSelect').value = scenario;
      saveToLocalStorage();
    }

    // Checklist toggle
    function toggleCheck(element) {
      element.classList.toggle('checked');
      saveToLocalStorage();
    }

    // Drawing Canvas
    const canvas = document.getElementById('drawingCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let currentTool = 'pen';
    let brushSize = 4;
    let currentColor = '#2563eb';
    let lastX = 0;
    let lastY = 0;
    let history = [];

    // Set canvas size
    function resizeCanvas() {
      const container = canvas.parentElement;
      const rect = container.getBoundingClientRect();
      canvas.width = Math.min(1100, rect.width - 4);
      canvas.height = 600;
      redrawCanvas();
    }

    // Initialize canvas
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Draw grid
    function drawGrid() {
      ctx.strokeStyle = '#e5e7eb';
      ctx.lineWidth = 1;
      const gridSize = 20;

      for (let x = 0; x < canvas.width; x += gridSize) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }

      for (let y = 0; y < canvas.height; y += gridSize) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }
    }

    drawGrid();

    // Save state for undo
    function saveState() {
      history.push(canvas.toDataURL());
      if (history.length > 20) history.shift();
    }

    // Undo
    function undoCanvas() {
      if (history.length > 0) {
        const img = new Image();
        img.onload = function() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          drawGrid();
          ctx.drawImage(img, 0, 0);
        };
        img.src = history.pop();
      }
    }

    function redrawCanvas() {
      drawGrid();
    }

    function clearCanvas() {
      if (confirm('Apakah Anda yakin ingin menghapus semua gambar?')) {
        saveState();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGrid();
        stamps = [];
      }
    }

    // Tool selection
    function setTool(tool) {
      currentTool = tool;
      document.querySelectorAll('.canvas-toolbar .tool-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    function setBrushSize(size) {
      brushSize = parseInt(size);
    }

    // Color picker
    document.getElementById('colorPicker').addEventListener('change', function() {
      currentColor = this.value;
    });

    // Drawing events
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);

    // Touch support
    canvas.addEventListener('touchstart', handleTouch);
    canvas.addEventListener('touchmove', handleTouchMove);
    canvas.addEventListener('touchend', stopDrawing);

    function handleTouch(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      lastX = touch.clientX - rect.left;
      lastY = touch.clientY - rect.top;
      isDrawing = true;
    }

    function handleTouchMove(e) {
      if (!isDrawing) return;
      e.preventDefault();
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;
      drawLine(lastX, lastY, x, y);
      lastX = x;
      lastY = y;
    }

    function startDrawing(e) {
      isDrawing = true;
      [lastX, lastY] = [e.offsetX, e.offsetY];

      if (currentTool === 'text') {
        const text = prompt('Masukkan teks:');
        if (text) {
          saveState();
          ctx.font = `${brushSize * 3}px Arial`;
          ctx.fillStyle = currentColor;
          ctx.fillText(text, lastX, lastY);
        }
        isDrawing = false;
      }

      if (currentTool === 'rect') {
        const width = prompt('Lebar kotak (px):', '60');
        const height = prompt('Tinggi kotak (px):', '40');
        if (width && height) {
          saveState();
          ctx.strokeStyle = currentColor;
          ctx.lineWidth = brushSize;
          ctx.strokeRect(lastX, lastY, parseInt(width), parseInt(height));
        }
        isDrawing = false;
      }

      if (currentTool === 'circle') {
        const radius = prompt('Jari-jari lingkaran (px):', '30');
        if (radius) {
          saveState();
          ctx.strokeStyle = currentColor;
          ctx.lineWidth = brushSize;
          ctx.beginPath();
          ctx.arc(lastX, lastY, parseInt(radius), 0, Math.PI * 2);
          ctx.stroke();
        }
        isDrawing = false;
      }
    }

    function draw(e) {
      if (!isDrawing) return;
      if (currentTool !== 'pen' && currentTool !== 'eraser') return;

      drawLine(lastX, lastY, e.offsetX, e.offsetY);
      [lastX, lastY] = [e.offsetX, e.offsetY];
    }

    function drawLine(x1, y1, x2, y2) {
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.strokeStyle = currentTool === 'eraser' ? '#ffffff' : currentColor;
      ctx.lineWidth = currentTool === 'eraser' ? brushSize * 3 : brushSize;
      ctx.lineCap = 'round';
      ctx.stroke();
    }

    function stopDrawing() {
      if (isDrawing) {
        saveState();
      }
      isDrawing = false;
    }

    // Zone stamps
    let stamps = [];

    const zoneNames = {
      1: 'Komando', 2: 'Rawat Pria', 3: 'Rawat Wanita', 4: 'OPD',
      5: 'ICU', 6: 'IGD', 7: 'Staf', 8: 'OK', 9: 'CSSD',
      10: 'Farmasi', 11: 'WC Staf', 12: 'X-Ray', 13: 'WC Pasien',
      14: 'Purifikasi', 15: 'Tangki Air', 16: 'Dapur', 17: 'Gudang',
      18: 'Genset', 19: 'Keamanan', 20: 'MHPSS'
    };

    function addStamp(zoneNum) {
      const zoneName = zoneNames[zoneNum];
      const x = 50 + (stamps.length % 10) * 100;
      const y = 50 + Math.floor(stamps.length / 10) * 80;

      saveState();
      ctx.fillStyle = currentColor;
      ctx.fillRect(x - 40, y - 20, 80, 40);
      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 12px Arial';
      ctx.textAlign = 'center';
      ctx.fillText(`${zoneNum}. ${zoneName}`, x, y + 5);

      stamps.push({ num: zoneNum, name: zoneName, x, y });
    }

    // Local Storage
    function saveToLocalStorage() {
      const data = {
        teamName: document.getElementById('teamName').value,
        teamMembers: document.getElementById('teamMembers').value,
        scenario: document.getElementById('scenarioSelect').value,
        notes: document.getElementById('teamNotes').value,
        canvasData: canvas.toDataURL(),
        checkedItems: []
      };

      document.querySelectorAll('.checklist li.checked').forEach((item, index) => {
        data.checkedItems.push(index);
      });

      localStorage.setItem('fieldHospitalWorksheet', JSON.stringify(data));
      showNotification('Data tersimpan!');
    }

    function loadFromLocalStorage() {
      const saved = localStorage.getItem('fieldHospitalWorksheet');
      if (saved) {
        const data = JSON.parse(saved);

        document.getElementById('teamName').value = data.teamName || '';
        document.getElementById('teamMembers').value = data.teamMembers || '';
        document.getElementById('scenarioSelect').value = data.scenario || '';
        document.getElementById('teamNotes').value = data.notes || '';

        // Restore canvas
        if (data.canvasData) {
          const img = new Image();
          img.onload = function() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGrid();
            ctx.drawImage(img, 0, 0);
          };
          img.src = data.canvasData;
        }

        // Restore checkboxes
        const items = document.querySelectorAll('.checklist li');
        data.checkedItems.forEach(index => {
          if (items[index]) items[index].classList.add('checked');
        });
      }
    }

    // Auto-save on input
    document.querySelectorAll('input, textarea, select').forEach(input => {
      input.addEventListener('input', saveToLocalStorage);
    });

    // Clear all data
    function clearAllData() {
      if (confirm('Apakah Anda yakin ingin menghapus semua data?')) {
        localStorage.removeItem('fieldHospitalWorksheet');
        location.reload();
      }
    }

    // Export as PDF
    async function exportAsPDF() {
      showNotification('Membuat PDF...');

      const { jsPDF } = window.jspdf;
      const element = document.getElementById('mainContent');

      try {
        const canvas = await html2canvas(element, {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          logging: false
        });

        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF('p', 'mm', 'a4');

        const imgWidth = 210;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;

        let heightLeft = imgHeight;
        let position = 0;

        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
        heightLeft -= 297;

        while (heightLeft > 0) {
          position = heightLeft - imgHeight;
          pdf.addPage();
          pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
          heightLeft -= 297;
        }

        const teamName = document.getElementById('teamName').value || 'Tim';
        pdf.save(`Rumah_Sakit_Lapangan_${teamName}_${new Date().toISOString().slice(0,10)}.pdf`);
        showNotification('PDF berhasil dibuat!');
      } catch (error) {
        console.error('PDF Error:', error);
        alert('Gagal membuat PDF. Silakan coba lagi atau gunakan fitur download gambar.');
      }
    }

    // Download canvas as image
    function downloadAsImage() {
      const link = document.createElement('a');
      const teamName = document.getElementById('teamName').value || 'Tim';
      link.download = `Desain_Rumah_Sakit_Lapangan_${teamName}.png`;
      link.href = canvas.toDataURL();
      link.click();
      showNotification('Gambar desain didownload!');
    }

    // Send to Google Drive
    function sendToGoogleDrive() {
      showNotification('Untuk menyimpan ke Google Drive:');

      const instructions = `
Cara menyimpan ke Google Drive:

1. Ekspor sebagai PDF terlebih dahulu (klik tombol "üìÑ Ekspor sebagai PDF")

2. Buka Google Drive (drive.google.com)

3. Upload file PDF yang sudah didownload

Atau gunakan Google Drive app di HP untuk langsung upload dari folder Downloads.

      `;

      alert(instructions);
    }

    // Show notification
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #10b981;
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        z-index: 1000;
        animation: fadeIn 0.3s ease;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // Load saved data on page load
    window.addEventListener('load', loadFromLocalStorage);

    // Save canvas state before unload
    window.addEventListener('beforeunload', saveToLocalStorage);
  </script>
</body>
</html>
